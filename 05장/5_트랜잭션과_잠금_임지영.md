# 5장 트랜잭션과 잠금

## 1. 트랜잭션
- 트랜잭션이란 모두 실패 또는 모두 성공을 보장하는 것

## 2. MySQL 엔진의 잠금
- 잠금은 트랜잭션을 위해 사용되는 기술임
- 잠금레벨은 스토리지 엔진 레벨과 MySQL 엔진 레벨로 나눌 수 있음.

### 글로벌 락
- select 를 제외한 거의 모든 DDL, DML문을 실행할 수 없음.
- MySQL 서버 전체에 영향을 미침. DB나 테이블이 다르더라도 마찬가지.
- 백업할때나 쓰임.
- InnoDB가 나오면서 좀더 가벼운 범위의 글로벌락이 도입되어 백업시에 쓰이고 있음. (p.160)

### 테이블 락
- 개별 테이블 단위로 설정되는 잠금
- 명시적 테이블 락 (거의 쓸 일 없음)
    ```sql
    lock table table_name [read | write];
    unlock tables;
    ```
- 묵시적 테이블 락
  - MyISAM, MEMORY 엔진에서 변경 쿼리를 실행할때 자동으로 잠금 획득하고 해제했던 락
  - InnoDB에서는 DDL의 경우에만 실행됨

### 네임드 락
- 임의의 문자열을 잠금하는 락
- 자주 사용되지 않음.
- get_lock() is_free_lock() 으로 락이 걸려있는지 확인할 수 있음.

### 메타데이터 락 
- 테이블이나 뷰의 이름이나 구조를 변경하는 경우 자동으로 획득하고 반납하는 락.

## 3.InnoDB 스토리지 엔진 잠금
- InnoDB는 레코드 기반 잠금 방식을 탑재함
- innodb_trx, innodb_locks , innodb_lock_waits 테이블로 트랜잭션 잠금 관련 정보를 조회할 수 있음
### InnoDB 스토리지 엔진의 잠금
1. 레코드락
   - 레코드 자체만을 잠그는 것을 레코드 락이라고 함. 
   - InnoDB 스토리지 엔진은 레코드 자체를 잠그는게 아니고 인덱스 레코드를 잠금
   - 인덱스가 없는 테이블이라도 내부적으로 자동 생성된 클러스터 인덱스를 이용해 잠금
   - 인덱스 레코드를 잠그는것과 레코드를 잠그는 것은 다르기 때문에 추후 설명함.
2. 갭락
   - 레코드 자체를 잠그는 게 아니라 레코드와 레코드 사이의 간격만을 잠금. 
   - 실제로 존재하는 데이터가 아니라, 그 사이 끼워질 데이터를 막기 위해 사이 공간을 잠그는 것
   - 넥스트 키 락의 일부로 자주 사용 됨
3. 넥스트 키락 
   - 레코드 락과 갭락을 합쳐 놓은 형태의 잠금. 
4. 자동 증가락
   
## 4. 격리 수준
### Read Uncommitted

### Read Committed

### Repeatable Read

### Serializable

---
질문
- 트랜잭션이 선택사항일 수 있나?
- 테이블 구조 변경시에 시간이 오래걸리는 경우(165p)
