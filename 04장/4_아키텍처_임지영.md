# 4장 아키텍처
## 1. MySQL 서버 엔진 아키텍처
### MySQL 아키텍처 전체 구조
- 프로그램API(WAS) -> MYSQL 엔진 -> 스토리지 엔진 -> 운영체제(데이터 파일, 로그 파일)
### MySQL 엔진
- 머리 역할
    - SQL 문장 분석 , 최적화
- 대부분의 작업을 처리함
- 종류
    1. 커넥션 핸들러
    2. 인터페이스
    3. 파서
    4. 옵티마이저
    5. 캐시 & 버퍼
### 스토리지 엔진
- 손발 역할
    - 디스크에 데이터 IO 작업
- 마지막 데이터 읽기/쓰기 작업 처리
- 종류
    1. InnoDB (현재 기본)
    2. MyISAM (5.5 버전 이전 기본)
    3. Memory

### Handler API

- MySQL 엔진과 스토리지 엔진이 서로 소통할때 사용하는 요청 api
  - 확인 명령어
      ```
    show global status like 'handler%'
     ```
### MySQL 스레딩 구조
- MySQL 은 프로세스가 아닌 스레드 기반으로 작동한다
- **포그라운드 스레드(클라이언트 스레드)**
    - MySQL 서버에 접속된 클라이언트의 수만큼 존재함
    - 사용자의 쿼리 문장을 처리한다
    - 읽기 작업을 주로 처리한다
    - 데이터 버퍼나 캐시까지만 처리하고 나머지 디스크 작업은 백그라운드 스레드가 처리함
- **백그라운드 스레드**
  - 하는일
    - 인서트 버퍼 병합
    - 로그를 디스크로 기록
    - innoDB 버퍼 풀의 데이터를 디스크에 기록
    - 데이터를 버퍼로 읽어옴
    - 잠금이나 데드락을 모니터링
  - 쓰기 작업을 전담하며 읽기 작업은 포그라운드 스레드에서도 담당하므로 읽기 쓰레드보다 쓰기 쓰레드 개수를 더 많이 설정해야한다
    - 쓰기 작업은 지연 처리가 가능하지만 읽기 작업은 즉시 읽어야 하므로 쓰기 작업은 버퍼 일괄 처리 기능이 있음. 

### 메모리 할당 및 사용 구조
- 글로벌 메모리 영역(스레드들 끼리 공유 하는 영역) / 로컬 메모리 영역
1. **글로벌메모리 영역**
  - 하나의 메모리 영역으로만 할당 된다
  - 모든 스레드가 공유한다 
  - 종류
    1. 테이블 캐시
    2. innoDB 버퍼 풀
    3. InnoDB 어댑티브 해시 인덱스
    4. InnoDB 리두(redo) 로그 버퍼
2. **로컬 메모리영역(세션 메모리 영역)**
   - 클라이언트 스레드가 쿼리를 처리하는데 사용하는 메모리 영역(서버에 존재)
   - 클라이언트 당 독립적으로 사용되며 절대 공유되지 않음.
   - 종류
     1. 정렬 버퍼
     2. 조인 버퍼
     3. 바이너리 로그 캐시
     4. 네트워크 버퍼

#### 플러그인 스토리지 엔진 모델
- 직접 만들수 있는 스토리지 엔진
- 사용되지 않는 스토리지 엔진을 사용하려면 서버를 껐다 켜야 되는데 플러그인 형태는 라이브러리를 다운해서 넣기만 하면 사용 할 수 있다.

### 컴포넌트
- 플러그인의 단점을 보완함.

### 쿼리 실행 구조
1. 쿼리 파서
   - 사용자 쿼리를 트리 형태의 구조로 만들어냄
2. 전처리기
   - 구조적인 문제점이 았는지 확인 -> 쿼리 유효성 확인, 인증 정보 확인
3. 옵티마이저
   - 실행 비용 최적화
4. 실행엔진
   - 손발 역할. 핸들러에게 요청해 다시 넘기는 역할을함
5. 핸들러(스토리지 엔진)
   - 디스크 IO 작업
6. 복제

### 쿼리 캐시
- 성능상 단점으로 8.0부터 사라짐

### 스레드 풀 
- 

### 트랜잭션 지원 메타 데이터
- 권한 등 기본 테이블이 트랜잭션을 지원하는 InnoDB 스토리지 엔진에 저장 됨.

