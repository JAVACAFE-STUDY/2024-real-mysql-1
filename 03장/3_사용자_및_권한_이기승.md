# 사용자 및 권한

## 사용자 식별
- MySQL은 사용자를 식별하는 데 사용하는 두 가지 정보가 있다.
    - 사용자 이름
    - 호스트 이름
    - 사용자 이름과 호스트 이름을 결합해 사용자를 식별한다.
```sql
'svc_id'@'127.0.0.1'
```
- 만약 외부 컴퓨터가 접속이 가능한 계정을 생성하고 싶다면 호스트 부분을 '%'로 설정하면 된다.
```sql
'svc_id'@'%'
```
- SQL 계정을 선택할 때는 범위가 작은 것을 한장 먼저 선택한다.
 

## 사용자 계정 관리
### 시스템 계정과 일반 계정
- 시스템 계정은 데이터베이스 서버 관리자를 위한 계정
- 일반 계정은 프로그램이나 개발자를 위한 계정
- 'root'@'localhost' 계정을 제외한 3개의 계정은 내부적으로 각기 다른 목적으로 사용되므로 삭제되지 않게 주의하자
  - 'mysql.infoschema'@'localhost'
    - infomation_schema에 정의된 뷰의 DEFINER로 사용되는 계정
  - 'mysql.session'@'localhost'
    - MySQL 플러그인이 서버로 접근할 때 사용되는 계정
  - 'mysql.sys'@'localhost'
    - MySQL sys 스키마에 접근할 수 있는 계정

### 계정생성
- 기존 5.7 버전까지는 GRANT 명령으로 계정을 생성했지만 8.0 버전부터는 CREATE USER 명령을 사용한다.
```sql
CREATE USER 'svc_id'@'localhost' IDENTIFIED BY 'svc_pw';
```
- 계정 생성 후 권한을 부여해야 한다.
```sql
GRANT ALL PRIVILEGES ON *.* TO 'svc_id'@'localhost';
```
- 계정 생성 옵션
  - `IDENTIFIED BY`
    - 계정 생성 시 비밀번호를 설정한다.
    - 비밀번호를 설정하지 않으면 비밀번호 없이 접속할 수 있다.
  - `REQUIRE`
    - 서버에 접속할 때 SSL/TLS 채널을 사용할지 여부를 설정한다.
  - `PASSWORD EXPIRE`
    - 비밀번호 만료 기간을 설정한다.
  - `PASSWORD HISTORY`
    - 이전 비밀번호를 사용할 수 있는 횟수를 설정한다.
  - `PASSWORD REUSE INTERVAL`
    - 이전 비밀번호 재사용 금지 기간을 설정한다.
  - `PASSWORD REQUIRE`
    - 비밀번호 변경 시 현재 비밀번호를 입력해야 하는지 여부를 설정한다.
  - `ACCOUNT LOCK / UNLOCK`
    - 계정 잠금 여부를 설정한다.

## 비밀번호 관리
- 고수준 비밀번호
  - 비밀번호의 복잡도에 대한 레벨을 글로벌 설정 변수로 설정한다. 관련된 컴포넌트의 설치가 필요하다.
- 비밀번호 정책
  - LOW: 길이만 검증
  - MEDIUM: 길이와 숫자, 대소문자, 특수문자 배합 검증
  - STRONG: 길이와 숫자, 대소문자, 특수문자 배합, 금칙어 포함 여부 검증이 결정된다.
- 이중 비밀번호
  - 이미 특정 계정으로 서비스 중일 경우 비밀번호의 변경이 제한 될 수 있다. 이때 비밀번호를 이중으로 함으로써 기존 서비스에 영향을 주지 않고 비밀번호를 변경하는 것이 가능하다.

  
## 권한(Privilege)
- 권한은 글로벌 권한과 객체 권한으로 구분된다. 
  - 글로벌 권한은 데이터베이스나 테이블 외에 적용되는 권한을 말하며, 객체 권한은 데이터베이스나 테이블을 제어하는데 필요한 권한을 말한다.
- 객체 권한은 특정 객체를 명확히 명시해야 하지만 글로벌 권한은 특정 객체를 명시하지 말아야 한다.
- ALL 키워드의 경우 객체 권한에서는 특정 객체에 대한 모드 권한을 의미하며, 글로벌 권한 에서는 글로벌 수준에서 가능한 모든 권한을 의미한다.
- MySQL 8.0 부터는 기존에 있던 권한을 정적 권한으로 구분하고, 컴포넌트가 플러그인이 설치되면 그때 부여되는 권한들을 동적 권한으로 구분했다.
- MySQL 5.7 때는 SUPER라는 권한이 데이터베이스 권한에 꼭 필요했으나 MySQL 8.0 부터는 SUPER 권한이 잘게 부서졌다.
- 컬럼 단위에 대해서도 권한 부여가 가능한데, 이는 권한 검증으로 인해 성능에 영향을 주므로 컬럼 단위 권한 관리는 안티 패턴이다.
- 권한 부여 현황은 mysql 데이터베이스 내 관련 테이블을 확인하면 된다.
  - `mysql.user` 테이블
    - 사용자 계정, 역할에 부여된 글로벌 권한
  - `mysql.db` 테이블
    - 데이터베이스별 권한
  - `mysql.tables_priv` 테이블
    - 테이블별 권한
  - `mysql.columns_priv` 테이블
    - 컬럼별 권한
  - `mysql.proc_priv` 테이블
    - 프로시저별 권한
  - `mysql.global_grants` 테이블
    - 동적 글로벌 권한

## 역할 (Role)
- 권한을 묶어서 역할이란 이름으로 포장할 수 있다. 
  - 동일한 권한을 가지는 아이디가 여러 개 있을 때 각각 권한을 일일히 부여해주는게 아니라 역할을 만들고 거기에 권한을 부여한 후 해당 권한을 아이디에 부여해주면 된다.