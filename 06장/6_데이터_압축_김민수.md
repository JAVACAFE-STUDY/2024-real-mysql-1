## 페이지 압축

- 디스크를 저장하는 시점에 압축되어 저장되고, 디스크를 읽어올 때 압축이 해제됨
    - innoDB 스토리지 엔진은 압축이 해제된 상태로 데이터 페이지를 관리함
- 하나의 테이블을 동일한 크기의 페이지(블록)로 통일해야 함
    - 그래서 페이지 압축 기능은 펀치 홀 기능을 사용함

### 페이지 압축 방식

```java
1. 16KB 페이지를 압축 (압축 결과를 7KB로 가정)
2. MySQL 서버는 디스크에 압축된 결과 7KB를 기록
3. 디스크에 데이터를 기록한 후, 7KB 이후의 공간 9KB에 대해 펀치 홀을 생성
4. 파일 시스템은 7KB만 남기고 나머지 디스크의 9KB 공간은 다시 운영체제로 반납
```

### 문제점

- 펀치 홀 기능은 운영체제뿐만 아니라 하드웨어 자체에서도 해당 기능을 지원해야 사용 가능함
- 아직 파일 시스템 관련 명령어가 펀치 홀을 지원하지 못함

그래서 많이 사용되지 않고 있다

### 테이블 압축

- 운영체제나 하드웨어에 대한 제약 없이 사용 가능 → 활용도가 더 높다
- 장점
    - 디스크의 데이터 파일의 크기를 줄일 수 있음
- 단점
    - 버퍼 풀 공간 활용률이 낮음
    - 쿼리 처리 성능이 낮음
    - 빈번한 데이터 변경 시 압축률이 떨어짐

### KEY_BLOCK_SIZE

- 압축된 결과를 예상해 사이즈를 정해야 한다
- 압축 알고리즘은 많은 CPU 자원을 소모한다

### 버퍼 풀

압축된 데이터 페이지를 버퍼 풀에 적재하면 압축된 상태와 해제된 상태 2개의 버전을 관리한다

- LRU 리스트
    - 압축이 적용 안된 테이블의 데이터 페이지
    - 압축이 적용된 테이블의 압축된 데이터 페이지
- Unzip_LRU 리스트
    - 압축이 적용된 테이블에서 읽은 데이터 페이지만 관리
    - 압축을 해제한 상태의 데이터 페이지 목록이 관리됨
    - 압축된 테이블에 대해 버퍼 풀의 공간을 이중으로 사용해 메모리를 낭비하게 된다.
    - 또한 압축된 페이지에서 데이터를 읽거나 변경할 때 압축을 해제해야 한다(CPU 소모량이 높음)
        - Unzip_LRU 리스트를 별도로 관리하다가 요청 패턴에 따라 적절히 처리 수행
